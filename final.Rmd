---
title: "Chess Project"
output: html_document
date: "2024-10-20"
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(colorspace)
```

```{r functions, include=FALSE}
square_to_pos <- function(square) {
  # Calculate the x and y positions
  x <- (square %% 8) + 1
  y <- (square %/% 8) + 1
  return(c(x, y))
}
```

## Common Moves

```{r moves, echo=FALSE}
moves <- read.csv("UseableCSV/move_count.csv")

moves <- moves %>%
  rowwise() %>%
  mutate(pos = list(square_to_pos(square))) %>%
  unnest_wider(pos, names_sep = "_") %>%
  rename(x = pos_1, y = pos_2)

renderPlot({
  ggplot(moves, aes(x = x, y = y, fill=count)) +
    geom_tile() +
    scale_x_continuous(breaks = 1:8, labels = c("a", "b", "c", "d", "e", "f", "g", "h")) +
    scale_y_continuous(breaks = 1:8) +
    coord_fixed() +
    scale_fill_gradient(low = "white", high = "red") +
    facet_wrap(~player) +
    labs(title = "Command Moves by White and Black", subtitle = "Seperated by players")
})
```
I realized that this graphic actually is best separated by players. Notice g1 and g8. It appears king side castling is more popular then queen side. Anywho because of this I will be keeping both graphs. This also is not terribly surprising as people love the center four squares, and supporting with kings knight or just another pawn in that f3, f6 space.


## Castling
```{r, echo=FALSE}
castles <- read.csv("UseableCSV/castle_counts.csv")

castles$side <- factor(castles$side, levels = c("Queen", "King"))

renderPlot({
  ggplot(castles, aes(x = side, y = count, fill = player)) +
    geom_bar(stat = "identity", color="black", position = position_dodge(width = 0.7), width = 0.6) +
    coord_flip() +
    labs(
        title = "Counts of King and Queen Sides by Player",
        x = "Side",
        y = "Count"
    ) +
    scale_fill_manual(values = c("white" = "white", "black" = "black")) +
    theme_minimal()
})
```



## Common Captures

```{r captures, echo=FALSE}
captures <- read.csv("UseableCSV/captures.csv")

inputPanel(
  selectInput("cap_player", label = "Player:",
              choices = c("white", "black"), selected = "white"),
  
  selectInput("piece", label = "Capturing Piece:",
              choices = c('pawn', 'rook', 'bishop', 'knight', 'queen', 'king'), selected = "pawn")
)

renderPlot({
  filtered_data <- captures %>%
      filter(player == input$cap_player & piece_moved == input$piece)
    
  ggplot(filtered_data, aes(x = piece_taken, y = count)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    labs(x = "Piece Taken", y = "Count", title = paste(input$player, input$piece, "captures")) +
    theme_minimal()
})
```


## Check Moves
This is whenever there is a check and what piece was moved that made a check.

```{r checksOrigins, echo=FALSE}
# Get Data
check_o <- read.csv("UseableCSV/check_origins.csv")

# - Get king square
check_o <- check_o %>%
  rowwise() %>%
  mutate(pos = list(square_to_pos(king_pos))) %>%
  unnest_wider(pos, names_sep = "_") %>%
  rename(x = pos_1, y = pos_2)

# - Get check from square
check_o <- check_o %>%
  rowwise() %>%
  mutate(pos = list(square_to_pos(check_square))) %>%
  unnest_wider(pos, names_sep = "_") %>%
  rename(check_x = pos_1, check_y = pos_2)


# Input
inputPanel(
  # Player
  selectInput("check_player", label = "Player:",
              choices = c("white", "black", "both"), selected = "white"),
  
  # x (row)
  selectInput("x_coord", "Select X (Row):", choices = 1:8),
  
  # y (column)
  selectInput("y_coord", "Select Y (Col):", choices = 1:8)
)

renderPlot({
  # Get King at x, y and player
  filtered_data <- check_o %>%
    filter((player == input$check_player) & 
             x == input$x_coord &
             y == input$y_coord)

  # Color King square
  # ?
  
  ggplot(filtered_data, aes(x = check_x, y = check_y, fill=count)) +
    geom_tile() +
    coord_fixed() +
    labs(title = paste("Check with King at", input$x_coord, ",", input$y_coord)) +
    theme_minimal()
})
```

